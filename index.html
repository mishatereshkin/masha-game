<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ú–∞—à–∞.exe üíñ</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíñ</text></svg>">

  <style>
    :root {
      --pink: #ff2f5e;
      --soft: #fff0f5;
      --soft2: #ffe6ee;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      overflow: hidden;
      height: 100vh;
      touch-action: manipulation;
    }

    .container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      padding: max(12px, env(safe-area-inset-top)) 
               12px 
               max(12px, env(safe-area-inset-bottom));
      background: rgba(255, 255, 255, 0.98);
      overflow: hidden;
    }

    h1 {
      margin: 0 0 4px;
      color: var(--pink);
      text-align: center;
      font-size: 1.8rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 12px;
    }

    .info {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      color: var(--pink);
      margin-bottom: 10px;
      font-size: 1.1rem;
      padding: 0 4px;
    }

    .game {
      flex: 1;
      background: var(--soft2);
      border-radius: 16px;
      position: relative;
      overflow: hidden;
      touch-action: none;
      box-shadow: inset 0 0 20px rgba(255, 47, 94, 0.1);
      margin-bottom: 8px;
    }

    .heart {
      position: absolute;
      top: -80px;
      font-size: 3rem;
      user-select: none;
      pointer-events: auto;
      animation: fall linear forwards;
      will-change: transform, top;
      cursor: pointer;
      z-index: 10;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
      transition: transform 0.1s;
    }
    
    .heart:active {
      transform: scale(1.2);
    }

    @keyframes fall {
      to {
        transform: translateY(calc(100vh + 80px));
      }
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 8px;
      touch-action: manipulation;
    }
    
    button {
      flex: 1;
      padding: 16px;
      border-radius: 50px;
      border: none;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      touch-action: manipulation;
      user-select: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    button:active {
      transform: translateY(2px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .start {
      background: var(--pink);
      color: white;
    }
    
    .start:hover, .start:active {
      background: #ff1a4d;
    }
    
    .alt {
      background: white;
      border: 2px solid #ffb3c1;
      color: var(--pink);
    }
    
    .alt:hover, .alt:active {
      background: #fff5f7;
    }

    .result {
      margin-top: 12px;
      background: white;
      border-radius: 14px;
      padding: 16px;
      font-size: 1rem;
      line-height: 1.4;
      text-align: center;
      color: #333;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border: 1px solid #ffd2de;
    }
    
    .hidden {
      display: none !important;
    }

    .music {
      position: absolute;
      top: max(12px, env(safe-area-inset-top));
      right: 12px;
      background: white;
      border: 2px solid #ffd2de;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      touch-action: manipulation;
      user-select: none;
      font-size: 1.2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }
    
    .music:active {
      transform: scale(0.95);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 360px) {
      h1 {
        font-size: 1.5rem;
      }
      
      button {
        padding: 14px;
        font-size: 0.9rem;
      }
      
      .heart {
        font-size: 2.5rem;
      }
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–µ—Ä–¥–µ—á–µ–∫ */
    @keyframes pop {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .heart.pop {
      animation: pop 0.3s ease-out;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="music" id="musicBtn" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">üîá</div>

    <h1>–ú–∞—à–∞ üíï</h1>
    <div class="subtitle">–ú–∏–Ω–∏-–∏–≥—Ä–∞ –æ—Ç –ú–∏—à–∏ üòà</div>

    <div class="info">
      <div>üíñ <span id="score">0</span></div>
      <div>‚è± <span id="time">20</span>—Å</div>
    </div>

    <div class="game" id="game"></div>

    <div class="buttons">
      <button class="start" id="start">–ü–æ–≥–Ω–∞–ª–∏ üí•</button>
      <button class="alt" id="fake">–ù–µ –Ω–∞–∂–∏–º–∞–π üòà</button>
    </div>

    <div class="result hidden" id="result"></div>
  </div>

  <!-- –ê—É–¥–∏–æ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ -->
  <audio id="bgMusic" loop preload="auto" crossorigin="anonymous">
    <!-- Fallback –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ data URI -->
    <source src="https://assets.mixkit.co/music/preview/mixkit-driving-ambition-32.mp3" type="audio/mpeg">
    <source src="data:audio/mpeg;base64,//MkxAA...–∫–æ—Ä–æ—Ç–∫–∏–π base64 –∞—É–¥–∏–æ..." type="audio/mpeg">
  </audio>
  
  <audio id="hitSound" preload="auto" crossorigin="anonymous">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
  </audio>

  <script>
    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const game = document.getElementById("game");
    const scoreEl = document.getElementById("score");
    const timeEl = document.getElementById("time");
    const result = document.getElementById("result");
    const startBtn = document.getElementById("start");
    const fakeBtn = document.getElementById("fake");
    const musicBtn = document.getElementById("musicBtn");

    // –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã
    const bgMusic = document.getElementById("bgMusic");
    const hitSound = document.getElementById("hitSound");

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const isAndroid = /Android/i.test(navigator.userAgent);
    const VOLUME = { 
      bg: isAndroid ? 0.15 : 0.25, 
      hit: isAndroid ? 0.4 : 0.5 
    };
    const GAME_TIME = 20; // —Å–µ–∫—É–Ω–¥—ã
    const HEART_SYMBOLS = ["üíñ", "üíò", "üíó", "üíù", "‚òï", "üòú", "ü•∞", "üòò"];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let score = 0;
    let timeLeft = GAME_TIME;
    let spawnInterval = null;
    let timerInterval = null;
    let musicOn = false;
    let gameActive = false;
    let hearts = new Set(); // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Ä–¥–µ—á–µ–∫

    // –û—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤
    function clearGameTimers() {
      if (spawnInterval) {
        clearInterval(spawnInterval);
        spawnInterval = null;
      }
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
    function vibrate(pattern) {
      if (navigator.vibrate && typeof navigator.vibrate === 'function') {
        try {
          navigator.vibrate(pattern);
        } catch (e) {
          console.log("Vibration not supported");
        }
      }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–æ–π
    function toggleMusic(forceState) {
      if (forceState !== undefined) {
        musicOn = forceState;
      } else {
        musicOn = !musicOn;
      }

      if (musicOn) {
        bgMusic.volume = VOLUME.bg;
        bgMusic.play().catch(e => {
          console.log("Music play error:", e);
          musicBtn.textContent = "üîá";
          musicOn = false;
        });
        musicBtn.textContent = "üîä";
        musicBtn.style.background = '#fff0f5';
      } else {
        bgMusic.pause();
        musicBtn.textContent = "üîá";
        musicBtn.style.background = 'white';
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
      localStorage.setItem('mashaGameMusic', musicOn);
    }

    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è
    function playHitSound() {
      try {
        hitSound.volume = VOLUME.hit;
        hitSound.currentTime = 0;
        const playPromise = hitSound.play();
        if (playPromise !== undefined) {
          playPromise.catch(e => {
            console.log("Hit sound play error:", e);
          });
        }
      } catch (e) {
        console.log("Hit sound error:", e);
      }
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–¥–µ—á–∫–∞
    function createHeart() {
      if (!gameActive) return;
      
      const heart = document.createElement("div");
      heart.className = "heart";
      
      // –°–ª—É—á–∞–π–Ω—ã–π —Å–∏–º–≤–æ–ª
      const symbol = HEART_SYMBOLS[Math.floor(Math.random() * HEART_SYMBOLS.length)];
      heart.textContent = symbol;
      
      // –ü–æ–∑–∏—Ü–∏—è
      const gameWidth = game.clientWidth;
      const heartSize = 48; // –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä
      const maxLeft = Math.max(0, gameWidth - heartSize);
      const left = Math.random() * maxLeft;
      heart.style.left = `${left}px`;
      
      // –°–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è
      const duration = 2 + Math.random() * 1.5; // 2-3.5 —Å–µ–∫—É–Ω–¥—ã
      heart.style.animationDuration = `${duration}s`;
      
      // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
      const heartId = Date.now() + Math.random();
      heart.dataset.id = heartId;
      hearts.add(heartId);
      
      // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
      const timeToLive = (duration + 0.5) * 1000; // +0.5s –∑–∞–ø–∞—Å–∞
      const removeTimeout = setTimeout(() => {
        heart.remove();
        hearts.delete(heartId);
      }, timeToLive);
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞/—Ç–∞–ø–∞
      const handleClick = (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        if (!gameActive) return;
        
        // –≠—Ñ—Ñ–µ–∫—Ç—ã
        vibrate(20);
        playHitSound();
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        score++;
        scoreEl.textContent = score;
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
        heart.style.animation = 'none';
        heart.style.transition = 'all 0.3s';
        heart.style.transform = 'scale(0)';
        heart.style.opacity = '0';
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
        setTimeout(() => {
          if (heart.parentNode) {
            heart.remove();
          }
          hearts.delete(heartId);
          clearTimeout(removeTimeout);
        }, 300);
      };
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      heart.addEventListener('pointerdown', handleClick);
      heart.addEventListener('click', handleClick);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–≥—Ä—É
      game.appendChild(heart);
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
      requestAnimationFrame(() => {
        heart.style.animationPlayState = 'running';
      });
      
      return heartId;
    }

    // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
    function startGame() {
      if (gameActive) return;
      
      // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
      clearGameTimers();
      gameActive = true;
      score = 0;
      timeLeft = GAME_TIME;
      hearts.clear();
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
      scoreEl.textContent = "0";
      timeEl.textContent = timeLeft.toString();
      result.classList.add("hidden");
      result.innerHTML = "";
      game.innerHTML = "";
      
      // –í–∫–ª—é—á–µ–Ω–∏–µ –º—É–∑—ã–∫–∏
      if (localStorage.getItem('mashaGameMusic') === 'true') {
        toggleMusic(true);
      }
      
      // –í–∏–±—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—Ç–∞
      vibrate(40);
      
      // –ó–∞–ø—É—Å–∫ —Å–ø–∞–≤–Ω–∞ —Å–µ—Ä–¥–µ—á–µ–∫
      spawnInterval = setInterval(() => {
        if (gameActive && hearts.size < 15) { // –ú–∞–∫—Å–∏–º—É–º 15 —Å–µ—Ä–¥–µ—á–µ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
          createHeart();
        }
      }, 700);
      
      // –¢–∞–π–º–µ—Ä –∏–≥—Ä—ã
      timerInterval = setInterval(() => {
        if (!gameActive) return;
        
        timeLeft--;
        timeEl.textContent = timeLeft.toString();
        
        if (timeLeft <= 0) {
          endGame();
        }
      }, 1000);
    }

    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
    function endGame() {
      gameActive = false;
      clearGameTimers();
      
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–µ—Ä–¥–µ—á–∫–∏
      game.querySelectorAll('.heart').forEach(heart => {
        heart.style.animationPlayState = 'paused';
        heart.style.transition = 'all 0.5s';
        heart.style.opacity = '0';
        heart.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          if (heart.parentNode) {
            heart.remove();
          }
        }, 500);
      });
      
      hearts.clear();
      
      // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      let message = '';
      if (score >= 30) {
        message = `–í–∞—É! –¢—ã –ø–æ–π–º–∞–ª–∞ ${score} —Å–µ—Ä–¥–µ—á–µ–∫! üíñ<br>–¢—ã —á–µ–º–ø–∏–æ–Ω–∫–∞! üèÜ`;
      } else if (score >= 20) {
        message = `–û—Ç–ª–∏—á–Ω–æ! ${score} —Å–µ—Ä–¥–µ—á–µ–∫ üíï<br>–ú–∏—à–∞ –æ—á–µ–Ω—å –¥–æ–≤–æ–ª–µ–Ω üòä`;
      } else if (score >= 10) {
        message = `–•–æ—Ä–æ—à–æ! ${score} —Å–µ—Ä–¥–µ—á–µ–∫ üíñ<br>–ú–∏—à–∞ —É–ª—ã–±–∞–µ—Ç—Å—è üòå`;
      } else {
        message = `${score} —Å–µ—Ä–¥–µ—á–µ–∫ üíï<br>–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑! –¢—ã —Å–º–æ–∂–µ—à—å –ª—É—á—à–µ üòâ`;
      }
      
      result.innerHTML = message;
      result.classList.remove("hidden");
      
      // –í–∏–±—Ä–∞—Ü–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
      vibrate([100, 50, 100]);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–ª–æ–∂–Ω–æ–π" –∫–Ω–æ–ø–∫–∏
    function handleFakeButton() {
      vibrate([30, 30, 30, 30]);
      result.innerHTML = "–Ø –∂–µ —Å–∫–∞–∑–∞–ª –Ω–µ –Ω–∞–∂–∏–º–∞—Ç—å! üòà<br>–ù–æ —Ç—ã –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–∞–º–∞—è –ª—É—á—à–∞—è! üíñ";
      result.classList.remove("hidden");
      
      // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        if (!gameActive) {
          result.classList.add("hidden");
        }
      }, 3000);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º—É–∑—ã–∫–∏
      const savedMusic = localStorage.getItem('mashaGameMusic');
      if (savedMusic === 'true') {
        toggleMusic(true);
      }
      
      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ
      bgMusic.volume = 0;
      hitSound.volume = 0;
      
      // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
      const unlockAudio = () => {
        if (bgMusic.paused) {
          bgMusic.play().then(() => {
            bgMusic.pause();
            bgMusic.currentTime = 0;
          }).catch(e => console.log("Audio unlock attempt failed"));
        }
      };
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      startBtn.addEventListener('click', startGame);
      startBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startGame();
      }, { passive: false });
      
      fakeBtn.addEventListener('click', handleFakeButton);
      fakeBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        handleFakeButton();
      }, { passive: false });
      
      musicBtn.addEventListener('click', () => toggleMusic());
      musicBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        toggleMusic();
      }, { passive: false });
      
      // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ –ø–æ –ø–µ—Ä–≤–æ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é
      const unlockEvents = ['click', 'touchstart', 'pointerdown'];
      unlockEvents.forEach(event => {
        document.addEventListener(event, unlockAudio, { 
          once: true, 
          passive: true 
        });
      });
      
      // –ü–∞—É–∑–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
      document.addEventListener('visibilitychange', () => {
        if (document.hidden && gameActive) {
          // –ü–∞—É–∑–∞ –∏–≥—Ä—ã
          gameActive = false;
          clearGameTimers();
          bgMusic.pause();
        } else if (!document.hidden && !gameActive && timeLeft > 0 && timeLeft < GAME_TIME) {
          // –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
          gameActive = true;
          startGame();
        }
      });
      
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –Ω–∞ –∏–≥—Ä–µ
      game.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        return false;
      });
    }

    // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
